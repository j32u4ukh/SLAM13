# 多個影像共同估計彼此的位姿，最小化估計誤差

## 狀態估計

『SLAM 模型』由『運動方程式』和『觀測方程式』組成：

![SLAM 模型](image/slam_model.png)

由於方程式都會受到雜訊影響，因此應假設『位姿 x』和『路標 y』服從某種機率分佈的隨機變數，而非明確的數值。

則問題變成：『當擁有 輸入資料 u 和 觀測資料 z 時，如何確定狀態 x, y 的條件機率分佈？』

![P(x, y| z, u)](image/pxyzu.png)

上式稱為『後驗機率』，可利用貝氏法則得到

![P(z, u | x, y) * P(x, y) / P(z, u)](image/pxyzu_bayes.png)

分母部份 P(z, u) 與待估計的狀態 x, y 無關，因此可忽略。分解後的左式稱為『似然(Likehood)』，右式稱為『先驗(Prior)』。

直接求後驗分佈是困難的，但『求一個狀態最佳估計，使得該狀態下後驗機率最大化』是可行的：

```
MAP(x, y) = argmax P(x, y| z, u) = argmax P(z, u | x, y) * P(x, y)
```

上式告訴我們，求解『最大後驗機率』相等於『最大化 似然和先驗的乘積』。

若缺乏『先驗(相機位姿或路標大概在哪裡)』，則可求解『最大似然估計(Maximize Likelihood Estimation, MLE)』：

![MLE](image/MLE.png)

似然：『在現在的位姿下，可能產生怎樣的觀測資料。』
最大似然估計：『在怎樣的狀態下，最可能產生現在觀測到的資料。』

## 最小平方法(求最大似然估計)

假設最大似然服從高斯分佈，考慮**單次觀測**的最大似然估計，使用『最小化負對數(有較好的數學形式)』來求解。
由於對數函數是單調遞增的，所以『對原函數求最大化』相當於『對負對數求最小化』。

最小化上式右側的二次型項，則獲得對狀態的最大似然估計。這個二次型稱為『馬哈拉諾比斯距離(Mahalanobis)』，又叫『馬式距離』。
它可以看成由 Q^-1_k,j 加權之後的歐式距離(二範數)，這個 Q^-1_k,j 也叫做**資訊矩陣**，即高斯分佈共變異數矩陣之逆。

---

考慮**批次資料**，通常假設各個時刻的輸入和觀測是相互獨立的，各個輸入之間也是獨立的，各個觀測之間也是獨立的，於是可以對聯合分佈進行因式分解：

定義各次輸入和觀測資料與模型之間的誤差為：

最小化所有時刻估計值與真實讀數之間的馬式距離，相當於求最大似然估計，負對數允許我們把乘積變成求和：

將問題轉變成『最小平方問題(Least Square Problem)』。

『批次狀態估計問題』可以轉化為『最大似然估計問題』，並使用『最小平方法』進行求解。