# (相機)運動

前端所在作的事，以一句話說明就是：『透過找出兩兩影像間，相同空間點所映射的像素點，估計相機之間的運動，以及該空間點的位置。』。

就像 向量(ab) 在描述 a 點到 b 點的運動，若 a 點是座標系的原點，則 向量(ab) 等價於 b 點在該座標系下的『位置』。

座標系(**相機可視為一種座標系**)之間的『運動』包含了『平移』與『旋轉』，若是在描述相對於『世界座標』的運動，則等價於其在世界座標下的『位置』和『姿態』。

『位置』和『姿態』合稱為『位姿』，用來描述座標系(比如相機)之間的運動，位姿包含了相機的『位置』和『姿態』，由一個『旋轉』加上一個『平移』組成。

![相機運動](image/CameraMovement.png)

*C1, C2 分別為兩個相機，空間點 P 分別映射到兩個相機的『成像平面』上的像素點，命名為 p1, p2。*

若要描述 C1 如何運動到 C2，可用位姿 T(12) 來表達 C1 在經過一個『旋轉』和一個『平移』，變成和 C2 相同的位置與姿態。

這個過程中，只可能有位置描述和姿態的不同，而它的長度、各個面的角度等性質不會有任何改變，可說 C1, C2 之間差了一個『歐式轉換(Euclidean Transform)』。

世界座標到相機座標，或是 C1 相機座標系到 C2 相機座標系都是『歐式轉換(Euclidean Transform)』。

當相機由 C1 運動到 C2，空間點 P 在相機座標系下的位置由 Pc1 變到 Pc2。

反過來，也可以利用 Pc1 和 Pc2 的關係，推論相機如何由 C1 運動到 C2，計算出『旋轉(R)』和『平移(t)』。

## 旋轉

歐式轉換由『旋轉』和『平移』組成,首先單純考慮旋轉，利用一個矩陣(R)來描述旋轉，稱之為『旋轉矩陣(Rotation Matrix)』。

```
a' = Ra
```

旋轉矩陣由兩個座標系組成，帶有一些特別的性質：它是一個行列式為1的『正交矩陣(矩陣的『逆』和『轉置』是一樣的矩陣)』。

反過來說，一個行列式為1的『正交矩陣』就會是一個『旋轉矩陣』。因此可將 n 維旋轉矩陣的集合定義為：

![SOn](image/SOn.png)

SO(n) 是『特殊正交群(Special Orthogonal Group)』的意思，SO(3) 只的就是 3D 空間中的旋轉。

```
『群』簡單來說就是：有特殊要求的矩陣，符合該要求的矩陣的集合稱為 XX 群，例如 『特殊正交群』。
```

## 平移

平移相當單純，只須將描述平移的向量(t)加到旋轉過後的座標上即可。

```
a' = Ra + t
```

## 轉換矩陣(Transform Matrix)

『轉換矩陣(T)』將旋轉矩陣和平移向量所帶來的轉換，透過『齊次座標』的形式，重新定義在同一個矩陣。又稱為『歐式轉換(Euclidean Transform)』。

同樣有特殊的結構：左上為旋轉矩陣，右上為平移向量，左下為 0 向量，右下為 1。這種矩陣又被稱為『特殊歐式群(Special Euclidean Group)』。

## 其他轉換

1. 相似轉換：歐式轉換 + 縮放，3D 相似轉換集合稱為『相似轉換群 Sim(3)』。
2. 仿射轉換：僅要求左上的 3*3 矩陣為『可逆矩陣』，不必是正交矩陣，又稱『正交投影』。仿射轉換後，正方形會變成平行四邊形。
3. 射影轉換：是最普遍的轉換，左上的 3*3 矩陣為『可逆矩陣』，右上為平移向量，左下為縮放向量，右下為齊次座標(x, y, z, w)的 w 項。真實世界到相片即為『射影轉換』，正方形在射影轉換後會變成不規則四邊形。

## 運動估計

不同的數據有不同的估計方式：

1. 一元相機：利用『對極 幾何/約束』和兩組 2D 點來估計運動。
2. 二元相機、RGB-D 相機或透過某種方式獲得了距離資訊，則可利用 ICP 以及兩組 3D 點來估計運動。
3. 一組 3D 點、一組 2D 點，即獲得了一些 3D 點和他們在相機的投影位置，利用 PnP 來估計運動。 

### 一元相機

1. 對極(Epipolar)約束：兩張比對好的影像，透過二維像素點的對應關係，恢復兩相機之間的運動。計算過程中使用『基礎矩陣 F (Fundamental Matrix)』和『本質矩陣 E (Essential Matrix)』，可以簡化對極約束的表達。運動估計變成先根據像素點的位置求出 F 或 E，再根據 F 或 E 求出 R, t。
2. 八點法(Eight-point-algorithm)：利用 8 對點來估計 E，再根據 E 求出 R, t。
3. 單應矩陣 H (Homography)：描述了兩個平面之間的對應關係，適用於場景中的特徵點都落在同一平面上(例如牆壁、地面)，透過 H 求出 R, t 的方法稱為『直接線性轉換法(Direct Linear Transform, DLT)』。

單應性在 SLAM 中具有重要意義，當特徵點共面或相機發生純旋轉時，基礎矩陣(F)的自由度下降，這就出現了所謂的『退化(degenerate)』。

現實中的資料總包含一些雜訊，這時若繼續使用八點法求解基礎矩陣，多餘出來的自由度將主要由雜訊來決定。

為了避免『退化』現象造成的影響，通常會同時估計 基礎矩陣(F) 和 單應矩陣(H)，並選擇重投影誤差比較小的那個作為最後的運動估計矩陣。

## 討論

* 尺度不確定性
* 初始化的『純旋轉』問題
* 多於 8 對點的情況

<table>
  <tr>
    <td><a href="https://j32u4ukh.github.io/SLAM13/class5.html">上一篇</a></td>
    <td><a href="https://j32u4ukh.github.io/SLAM13/">首頁</a></td>
    <td><a href="https://j32u4ukh.github.io/SLAM13/class7.html">下一篇</a></td>
  </tr>
</table>