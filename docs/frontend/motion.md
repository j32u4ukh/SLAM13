# 運動

SLAM 是在『相機運動』過程中建立環境的模型，在定義座標系時，通常會設定一個慣性座標系(或叫世界座標系)，可以認為它是固定不動的，而相機是一個移動座標系，SLAM 的運算過程中，經常需要對兩個座標系下的座標進行轉換。

兩個座標系之間的運動由一個『旋轉』和一個『平移』組成，這種運動稱為『剛體運動』。可以想像將手機拋到空中，在它落地前，只可能有空間位置和姿態的不同，而它的長度、各個面的角度等性質不會有任何變化。兩座標系之間，差了一個『歐式轉換(Euclidean Transform)』。

> **剛體**(rigid body)是一種有限尺寸，可以忽略形變的固體。不論是否感受到外力，在剛體內部，質點與質點之間的距離都不會改變。這種理想模型適用條件是，運動過程比固體中的彈性波的傳播要緩慢得多。

![P_c to P_w](../image/euclidean_transform.png)

剛體運動的過程中，將相機視為 3D 空間的剛體，具有『位置(在空間中的哪個地方)』和『姿態(相機的朝向)』兩項性質用於描述相機的狀態，比如『相機位於空間(0, 0, 0)點處，朝向正前方』，位置與姿態合稱為『位姿』。


就像 向量(ab) 在描述 a 點到 b 點的運動，若 a 點是座標系的原點，則 向量(ab) 等價於 b 點在該座標系下的『位置』。

* 位姿 = 位置 + 姿態，用來描述座標系(比如相機)的狀態。
* 座標系(比如相機)之間的運動 = 平移 + 旋轉，若是在描述相對於『世界座標』的運動，則等價於其在世界座標下的『位置』和『姿態』。


點 P 在世界座標系中的點 P_w，在相機座標系下的座標為 P_c，若要轉換兩個座標系下的座標，需要先獲得 P_c 再根據相機的『位姿』轉換到世界座標系。



---



---

![相機運動](../image/CameraMovement.png)

*C1, C2 分別為兩個相機，空間點 P 分別映射到兩個相機的『成像平面』上的像素點，命名為 p1, p2。*

若要描述 C1 如何運動到 C2，可用位姿 T(12) 來表達 C1 在經過一個『旋轉』和一個『平移』，變成和 C2 相同的位置與姿態。

這個過程中，只可能有位置描述和姿態的不同，而它的長度、各個面的角度等性質不會有任何改變，可說 C1, C2 之間差了一個『歐式轉換(Euclidean Transform)』。

世界座標到相機座標，或是 C1 相機座標系到 C2 相機座標系都是『歐式轉換(Euclidean Transform)』。

當相機由 C1 運動到 C2，空間點 P 在相機座標系下的位置由 Pc1 變到 Pc2。

反過來，也可以利用 Pc1 和 Pc2 的關係，推論相機如何由 C1 運動到 C2，計算出『旋轉(R)』和『平移(t)』。

## 旋轉

歐式轉換由『旋轉』和『平移』組成,首先單純考慮旋轉，利用一個矩陣(R)來描述旋轉，稱之為『旋轉矩陣(Rotation Matrix)』。

```
a' = Ra
```

旋轉矩陣由兩個座標系組成，帶有一些特別的性質：它是一個行列式為1的『正交矩陣(矩陣的**逆**和**轉置**是一樣的矩陣)』。

反過來說，一個行列式為 1 的『正交矩陣』就會是一個『旋轉矩陣』。因此可將 n 維旋轉矩陣的集合定義為：

![SOn](image/SOn.png)

SO(n) 是『特殊正交群(Special Orthogonal Group)』的意思，SO(3) 只的就是 3D 空間中的旋轉。

```
『群』簡單來說就是：有特殊要求的矩陣，符合該要求的矩陣的集合稱為 XX 群，例如 『特殊正交群』。
```

## 平移

平移相當單純，只須將描述平移的向量(t)加到旋轉過後的座標上即可。

```
a' = Ra + t
```

## 轉換矩陣(Transform Matrix)

『轉換矩陣(T)』將旋轉矩陣和平移向量所帶來的轉換，透過『齊次座標』的形式，重新定義在同一個矩陣。又稱為『歐式轉換(Euclidean Transform)』。

同樣有特殊的結構：左上為旋轉矩陣，右上為平移向量，左下為 0 向量，右下為 1。這種矩陣又被稱為『特殊歐式群(Special Euclidean Group)』。

## 其他轉換

1. 相似轉換：歐式轉換 + 縮放，3D 相似轉換集合稱為『相似轉換群 Sim(3)』。
2. 仿射轉換：僅要求左上的 3*3 矩陣為『可逆矩陣』，不必是正交矩陣，又稱『正交投影』。仿射轉換後，正方形會變成平行四邊形。
3. 射影轉換：是最普遍的轉換，左上的 3*3 矩陣為『可逆矩陣』，右上為平移向量，左下為縮放向量，右下為齊次座標(x, y, z, w)的 w 項。真實世界到相片即為『射影轉換』，正方形在射影轉換後會變成不規則四邊形。

## 運動估計

不同的數據有不同的估計方式：

1. 一元相機：利用『對極 幾何/約束』和兩組 2D 點來估計運動。
2. 二元相機、RGB-D 相機或透過某種方式獲得了距離資訊，則可利用 ICP 以及兩組 3D 點來估計運動。
3. 一組 3D 點、一組 2D 點，即獲得了一些 3D 點和他們在相機的投影位置，利用 PnP 來估計運動。 


