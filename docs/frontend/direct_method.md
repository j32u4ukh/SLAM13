# 前端：直接法

基於光流法，尋找兩相機間的同一點。優點有計算速度快，在缺乏紋理特徵的情況下也可使用，可建置半稠密與稠密地圖(特徵點法無法做到)。

* 直接法是由光流法演變而來，具有相同的假設條件。光流描述了像素在影像中的運動，而直接法則附帶一個相機運動模型。

* 特徵點法只能恢復成稀疏地圖；直接法可以恢復成半稠密甚至是稠密地圖。

* 『特徵法』中的特徵比對，『直接法』透過最小化『光度誤差(Photometric error)』來求得點與點之間的對應關係。

* 直接法根據影像的『像素灰階資訊/亮度資訊』同時估計相機運動和點的投影，不要求分析的點必須為角點，甚至可以是隨機的選點，完全不用計算關鍵點和描述子。

* 直接法避免了『計算特徵的時間』，也避免了『特徵缺失的情況』。只要場景中存在明暗變化(可以是漸層，不形成局部的影像梯度)，直接法就能工作。

* 在光流法中，1. 先追蹤特徵點的位置 2. 根據 1 估計的位置確定相機的運動。然而這種兩步走的方案(1 → 2)，很難保障全域的最佳性。
而直接法可在後一步，調整前一步的結果(2 → 1)。

假設對於參考影像，測量到一個灰階值為 229 的像素，利用三角測量等方式知道了深度，可以推測空間點 P 的位置。

之後又獲得一幅新的影像，根據前面反覆運算的最佳化結果來估計它的位姿，獲得灰階值為 126，此像素的光度誤差為 229 - 126 ＝ 103。

為了減小這個誤差，會**微調相機的位姿，使像素更亮一些**。

位姿的調整會根據局部的像素梯度，但由於真實影像並不是光滑的，此方法只在該像素附近有效。

只有當相機運動很小，影像中的梯度不會有很強的非凸性時，才能降低落入局部極小值得可能，使直接法得以成立。

> 前項利用單個像素來進行相機位姿估計，會有『單一像素沒有區分度』的問題產生，因為相似灰階值的像素太多了。通常會計算『影像塊』或是『相關性』。

